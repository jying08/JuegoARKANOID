<title>Aranoid en JavaScript</title>
<style>
  body {
    background-color: #111;
  }
  canvas {
    border: 4px solid #fff;
    border-bottom: transparent;
    background: #000;
    margin: 0 auto;
    display: block;
  }
</style>

<canvas></canvas>
<script>
  const canvas = document.querySelector("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = 448;
  canvas.height = 400;

  //VARIABLES DE LA PELOTA
  const ballRadius = 3;
  //posicion de la pelota
  let x = canvas.width / 2;
  let y = canvas.height - 30;

  //velocidad de la pelota
  let dx = -2;
  let dy = -2;

  //variables de la paleta
  const paddleHeihgt=10;
  const paddleWidth=50;

  let paddleX=(canvas.width-paddleWidth)/2
  let paddleY=canvas.height-paddleHeihgt-10

  let rightPressed=false
  let leftPressed=false

  const PADDLE_SENSIBILITY=5

  function drawBall() {
    ctx.beginPath();//iniciar trasado
    ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
    ctx.fillStyle = "#fff";
    ctx.fill();
    ctx.closePath();//terminar trasado
  }
  function drawPadle() {
    ctx.fillStyle='red'
    ctx.fillRect(paddleX,paddleY,paddleWidth,paddleHeihgt)
  }
  function drawBricks() {}

  function collisionDetection() {}
  function ballMovement() {
    if (x + dx > canvas.width - ballRadius || //la paredet derecha
        x + dx < ballRadius) // la pared izquierda 
    {
      dx = -dx;
    }

    // rebotar en la parte de arriba
    if(y+dy<ballRadius)
    {
        dy=-dy
    }
    // la pelota toca la pala
    const isBallSameXAsPaddle=
    x>paddleX &&
    x<paddleX+paddleWidth

    const isBallTouchingPaddle=
    y+dy>paddleY

    
    if(isBallSameXAsPaddle&&isBallTouchingPaddle)
    {
      dy=-dy
    }
    else if(y+dy>canvas.height-ballRadius)//Ã±a pelota toca el suelo
    {
        console.log('game over')
        document.location.reload()
    }



    x += dx;
    y += dy;
  }
  function cleanCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  function initEvents()
  {
    document.addEventListener('keydown',keyDownHandler)
    document.addEventListener('keyup',keyUpHandler)

    function keyDownHandler(event){
      const{key}=event
      if(key==='Right'||key==='ArrowRight'){
        rightPressed=true
      }else if(key==='Left'||key==='ArrowLeft'){
        leftPressed=true
      }
    }
    function keyUpHandler(event){
      const{key}=event
      if(key==='Right'||key==='ArrowRight'){
        rightPressed=false
      }else if(key==='Left'||key==='ArrowLeft'){
        leftPressed=false
      }
    }




  }
  function paddleMovement() {
    if(rightPressed&&paddleX<canvas.width-paddleWidth)
    {
      paddleX+=PADDLE_SENSIBILITY
    }else if(leftPressed&&paddleX>0)
    {
      paddleX-=PADDLE_SENSIBILITY
    }
  }

  function draw() {
    console.log(rightPressed,leftPressed)
    cleanCanvas();
    // hay que dibujar los elementos
    drawBall();
    drawPadle();
    drawBricks();

    //coliciones y movimientos
    collisionDetection();
    ballMovement();
    paddleMovement();

    console.log("hola");
    window.requestAnimationFrame(draw);
  }
  draw();
  initEvents();
</script>
